# qcc_plus 项目记忆（精简版）

- 本文件必须保持简洁、准确、实时更新。
- 所有对话与说明一律使用中文。
- 默认 **YOLO 模式**：收到任务立即执行，除非权限/安全/缺失信息阻塞。

## 基本信息
- 项目类型：Go 1.21 CLI，复刻 Claude Code CLI 行为（消息模式 + 代理模式）。
- 主要目录：`cmd/cccli`（入口），`internal/client`（请求/预热/SSE），`internal/proxy`（反向代理），`cccli/*.txt|json`（系统提示与工具 embed）。
- 推荐工具：搜索用 `rg`；格式化 `gofmt`；测试 `go test ./...`；必要时 `go vet`。
- 当前仓库无 Docker、无前端、无 `.claude/agents`，忽略旧规则中的容器与设计审查要求。

## 必守规则
- 回复与文档均用中文，保持简洁结论导向。
- 禁止使用破坏性 git 命令（如 `git reset --hard`）。
- 修改 Go 代码后必须执行：`gofmt` → `go test ./...`；更改协议/流式/代理逻辑时再跑 `go vet ./...`。
- 环境变量示例存放 `.env.test`（dummy 值），勿提交真实密钥。
- 优先采用仓库现有脚本或 Go 标准工具，不引入重量依赖；新增脚本放 `scripts/` 并短注释。

## 工作流程
1) 理解需求：阅读 `README.md` 与相关源码，确认目标与影响面。
2) 编码前检查依赖：查看 `go.mod`，如需新模块，说明用途并最小化新增。
3) 编码实现：保持函数职责单一，错误处理清晰；涉及并发注意数据竞争（`sync`/context 超时）。
4) 测试验证：
   - 必跑 `go test ./...`；如触达网络/长耗时可条件跳过并注明条件。
   - 修改请求/代理/SSE 时补充或更新对应 `*_test.go`，覆盖正常与异常路径。
5) 文档同步：CLI 参数或环境变量变化需更新 `README.md`；重大决策可在相关文件附近添加简短注释。
6) 交付输出：一次性说明改动点、运行的测试结果、已知风险/后续待办。

## 测试要求
- 不使用虚构数据掩盖真实行为；可复用 `.env.test` 的 dummy 配置。
- 测试应包含错误路径断言（异常 token、网络失败、非法参数等）。
- 若测试需外部服务且当前不可达，可 `t.Skip` 并写明触发条件。

## 版本信息
- 最后更新：2025-11-21
- 版本：v2.0.0
