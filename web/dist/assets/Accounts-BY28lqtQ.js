import{r as a,j as e}from"./vendor-HVpYYIdB.js";import{C as A}from"./Card-Bmh2bB8_.js";import{T as E}from"./Toast-BukLN0_W.js";import{u as R}from"./useDialog-CfRkIH_r.js";import{c}from"./index-DkYsKbpr.js";import"./charts-USIkmnH5.js";function W(){const[b,C]=a.useState([]),[r,f]=a.useState(""),[i,d]=a.useState(""),[n,u]=a.useState(""),[l,m]=a.useState(""),[h,p]=a.useState("false"),[_,k]=a.useState(!1),[v,N]=a.useState(null),P=R(),x=a.useRef(null),s=(t,o="success")=>{N({message:t,type:o}),setTimeout(()=>N(null),2200)},y=()=>{f(""),d(""),u(""),m(""),p("false")},w=()=>{x.current&&x.current.scrollIntoView({behavior:"smooth",block:"start"})},j=async()=>{k(!0);try{const t=await c.getAccounts();C(t)}catch{s("加载账号失败","error")}finally{k(!1)}};a.useEffect(()=>{j()},[]);const S=async t=>{if(t.preventDefault(),!i.trim()||!l.trim()){s("名称和 Proxy API Key 必填","error");return}if(!r&&n.trim().length<6){s("新账号密码至少 6 位","error");return}if(r&&n&&n.trim().length>0&&n.trim().length<6){s("密码至少 6 位","error");return}try{r?(await c.updateAccount(r,{name:i.trim(),password:n.trim()||void 0,proxy_api_key:l.trim(),is_admin:h==="true"}),s("账号已更新")):(await c.createAccount({name:i.trim(),password:n.trim(),proxy_api_key:l.trim(),is_admin:h==="true"}),s("账号已创建")),y(),j()}catch(o){s(o.message||"保存失败","error")}},I=t=>{f(t.id),d(t.name),u(""),m(t.proxy_api_key),p(t.is_admin?"true":"false"),w()},K=async t=>{if(await P.confirm({title:"确认删除",message:"确定删除该账号？"}))try{await c.deleteAccount(t),s("账号已删除"),j()}catch(g){s(g.message||"删除失败","error")}};return e.jsxs("div",{className:"accounts-page",children:[e.jsxs("div",{className:"accounts-header",children:[e.jsx("h1",{children:"账号管理"}),e.jsx("p",{className:"sub",children:"仅管理员可见：管理租户账号、后台登录密码与代理密钥。"})]}),e.jsxs(A,{title:r?`编辑账号: ${i||"未命名"}`:"新增账号",children:[e.jsxs("form",{className:"inline-form",onSubmit:S,autoComplete:"off",ref:x,children:[e.jsx("input",{type:"hidden",value:r}),e.jsxs("label",{children:["账号名称",e.jsx("input",{value:i,onChange:t=>d(t.target.value),placeholder:"输入账号名称",autoComplete:"username",required:!0})]}),e.jsxs("label",{children:["密码",e.jsx("input",{value:n,onChange:t=>u(t.target.value),type:"password",placeholder:"设置密码（6位及以上）",autoComplete:"new-password"})]}),e.jsxs("label",{children:["Proxy API Key",e.jsx("input",{value:l,onChange:t=>m(t.target.value),placeholder:"用于代理调用的 x-api-key",required:!0,autoComplete:"off"})]}),e.jsxs("label",{children:["管理员权限",e.jsxs("select",{value:h,onChange:t=>p(t.target.value),children:[e.jsx("option",{value:"false",children:"普通账号"}),e.jsx("option",{value:"true",children:"管理员"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn primary",type:"submit",disabled:_,children:r?"更新账号":"创建账号"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:y,children:r?"取消编辑":"清空"})]})]}),e.jsx("small",{className:"muted",style:{display:"block",marginTop:16,color:"rgba(255,255,255,0.5)"},children:r?`正在编辑账号 ${i||"当前账号"}，密码留空则不修改`:"新账号请设置 6 位及以上密码"})]}),e.jsxs(A,{title:"账号列表",extra:e.jsx("small",{className:"muted",style:{color:"rgba(255,255,255,0.5)"},children:"账号密码用于后台登录，Proxy API Key 仍用于 API 调用。"}),children:[e.jsx("div",{className:"toolbar",children:e.jsx("button",{className:"btn primary",type:"button",onClick:()=>{y(),w()},children:"➕ 新增账号"})}),e.jsxs("table",{className:"accounts-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"名称"}),e.jsx("th",{children:"Proxy API Key"}),e.jsx("th",{children:"角色"}),e.jsx("th",{style:{minWidth:160},children:"操作"})]})}),e.jsx("tbody",{children:_?e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:e.jsx("div",{className:"skeleton",style:{height:20,background:"rgba(255,255,255,0.1)",borderRadius:4}})})}):b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"暂无账号"})}):b.map(t=>{const o=r===t.id,g=t.proxy_api_key&&t.proxy_api_key.length>20?`${t.proxy_api_key.slice(0,8)}...${t.proxy_api_key.slice(-8)}`:t.proxy_api_key||"-",T=async()=>{try{await navigator.clipboard.writeText(t.proxy_api_key),s("已复制 Proxy API Key")}catch{s("复制失败，请手动复制","error")}};return e.jsxs("tr",{className:o?"editing":void 0,children:[e.jsx("td",{children:t.name}),e.jsxs("td",{children:[e.jsx("code",{children:g}),t.proxy_api_key?e.jsx("button",{className:"btn ghost",type:"button",onClick:T,style:{marginLeft:8,padding:"2px 8px",fontSize:12},children:"复制"}):null]}),e.jsx("td",{children:t.is_admin?"管理员":"普通"}),e.jsx("td",{children:e.jsxs("div",{className:"table-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>I(t),children:"编辑"}),e.jsx("button",{className:"btn danger",type:"button",onClick:()=>K(t.id),children:"删除"})]})})]},t.id)})})]})]}),e.jsx(E,{message:v?.message,type:v?.type})]})}export{W as default};
