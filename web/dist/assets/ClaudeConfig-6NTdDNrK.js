import{r as n,j as e}from"./vendor-HVpYYIdB.js";import{C as f}from"./Card-B8iKcX7i.js";import{T as U}from"./Toast-D5AN34u6.js";import{c as P}from"./index-Cl6wuNBU.js";import"./charts-USIkmnH5.js";const E=a=>a.split(/[,\n;]+/).map(t=>t.trim()).filter(Boolean),K=a=>{if(!a)return"--";const t=new Date(a);return Number.isNaN(t.getTime())?"--":`${t.getMonth()+1}/${t.getDate()} ${t.toLocaleTimeString()}`};function F(){const[a,t]=n.useState(null),[c,N]=n.useState(""),[d,b]=n.useState(""),[m,L]=n.useState(""),[u,v]=n.useState(""),[h,y]=n.useState(""),[r,w]=n.useState("unix"),[x,C]=n.useState(!0),[j,S]=n.useState(!1),[_,T]=n.useState(null),[I,k]=n.useState(null),p=n.useRef(!1),i=n.useRef(void 0),o=(s,l="success")=>{T({message:s,type:l}),window.setTimeout(()=>T(null),2e3)},$=async()=>{C(!0);try{const s=await P.getClaudeConfigTemplate({});t(s),N(s.proxy_url||(typeof window<"u"?window.location.origin:"")),b(s.api_key||""),k(new Date().toISOString())}catch(s){o(s?.message||"加载配置模板失败","error")}finally{C(!1),p.current=!0}},R=async(s=!1)=>{if(p.current){s||S(!0);try{const l=await P.getClaudeConfigTemplate({proxy_url:c.trim(),api_key:d.trim(),model:m.trim()||void 0,allow:E(u),deny:E(h)});t(l),k(new Date().toISOString())}catch(l){o(l?.message||"刷新失败","error")}finally{s||S(!1)}}};n.useEffect(()=>{$()},[]),n.useEffect(()=>{if(p.current)return i.current&&window.clearTimeout(i.current),i.current=window.setTimeout(()=>R(!0),420),()=>{i.current&&window.clearTimeout(i.current)}},[c,d,m,u,h]);const g=n.useMemo(()=>a?r==="windows"?a.install_cmd.windows:a.install_cmd.unix:"",[r,a]),A=async(s,l)=>{if(s)try{await navigator.clipboard.writeText(s),o(`${l} 已复制到剪贴板`)}catch{o("复制失败，请手动复制","error")}},O=()=>{a?.config_id&&window.open(`/api/claude-config/download/${a.config_id}`,"_blank")},D=()=>{v(""),y("")};return e.jsxs("div",{className:"claude-config-page",children:[e.jsxs("div",{className:"claude-config-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Claude Code 快速配置"}),e.jsx("p",{className:"sub",children:"生成 settings.json、复制安装命令，一步完成本地接入。"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("span",{className:"pill",children:["当前账号：",a?.account_name||"—"]}),I&&e.jsxs("span",{className:"pill ghost",children:["更新于 ",K(I)]})]})]}),e.jsxs(f,{className:"install-card",children:[e.jsxs("div",{className:"install-top",children:[e.jsxs("div",{children:[e.jsx("div",{className:"eyebrow",children:"一键安装命令"}),e.jsx("div",{className:"title-line",children:"复制到终端直接生成 ~/.claude/settings.json"})]}),e.jsxs("div",{className:"install-actions",children:[e.jsxs("div",{className:"tabs",role:"tablist",children:[e.jsx("button",{className:`tab ${r==="unix"?"active":""}`,onClick:()=>w("unix"),type:"button",children:"macOS / Linux"}),e.jsx("button",{className:`tab ${r==="windows"?"active":""}`,onClick:()=>w("windows"),type:"button",children:"Windows PowerShell"})]}),e.jsx("button",{className:"btn primary large",type:"button",onClick:()=>A(g,"安装命令"),disabled:!g,children:"复制命令"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:O,disabled:!a?.config_id,children:"下载 JSON"})]})]}),e.jsxs("div",{className:"command-block",children:[e.jsx("pre",{className:"command-text",children:g||"加载中..."}),e.jsxs("div",{className:"command-meta",children:[e.jsxs("div",{className:"badge",children:["Config ID: ",a?.config_id||"—"]}),e.jsxs("div",{className:"badge ghost",children:["直连：",a?.proxy_url||c||"—"]})]})]})]}),e.jsxs("div",{className:"config-grid",children:[e.jsxs(f,{className:"config-card",children:[e.jsxs("div",{className:"section-head",children:[e.jsxs("div",{children:[e.jsx("div",{className:"eyebrow",children:"基础信息"}),e.jsx("h3",{className:"section-title",children:"代理与密钥"})]}),e.jsx("div",{className:"tiny-actions",children:e.jsx("button",{className:"btn ghost small",type:"button",onClick:()=>R(!1),disabled:j||x,children:j?"同步中…":"重新生成"})})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"代理地址"}),e.jsx("input",{value:c,onChange:s=>N(s.target.value),placeholder:"https://your-proxy.example.com"}),e.jsx("small",{children:"默认取当前服务器地址，可自定义。"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Proxy API Key"}),e.jsx("input",{value:d,onChange:s=>b(s.target.value),placeholder:"复制账号的 proxy_api_key"}),e.jsx("small",{children:"将写入 ANTHROPIC_API_KEY。"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"默认模型（可选）"}),e.jsx("input",{value:m,onChange:s=>L(s.target.value),placeholder:"例如 claude-3-5-sonnet-20241022"}),e.jsx("small",{children:"不填则使用 CLI 默认模型。"})]})]}),e.jsxs("div",{className:"section-head compact",children:[e.jsxs("div",{children:[e.jsx("div",{className:"eyebrow",children:"权限配置（可选）"}),e.jsx("h3",{className:"section-title",children:"允许 / 拒绝列表"})]}),e.jsx("button",{className:"btn ghost small",type:"button",onClick:D,children:"清空"})]}),e.jsxs("div",{className:"perm-grid",children:[e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"允许执行"}),e.jsx("textarea",{rows:3,value:u,onChange:s=>v(s.target.value),placeholder:"例如: git status\\nnpm run lint"}),e.jsx("small",{children:"多行或逗号分隔。"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"拒绝执行"}),e.jsx("textarea",{rows:3,value:h,onChange:s=>y(s.target.value),placeholder:"例如: rm -rf /"})]})]})]}),e.jsxs(f,{className:"preview-card",children:[e.jsxs("div",{className:"section-head",children:[e.jsxs("div",{children:[e.jsx("div",{className:"eyebrow",children:"实时预览"}),e.jsx("h3",{className:"section-title",children:"settings.json"})]}),e.jsxs("div",{className:"tiny-actions",children:[e.jsx("button",{className:"btn ghost small",type:"button",onClick:()=>A(a?.config_json||"","配置文件"),children:"复制 JSON"}),e.jsx("button",{className:"btn ghost small",type:"button",onClick:O,disabled:!a?.config_id,children:"下载"})]})]}),e.jsx("div",{className:"json-preview",children:e.jsx("pre",{children:a?.config_json||`{
  "env": {
    "ANTHROPIC_BASE_URL": "…"
  }
}`})}),e.jsxs("div",{className:"footnote",children:["运行命令后将生成于 ",e.jsx("code",{children:"~/.claude/settings.json"}),"（Windows: ",e.jsx("code",{children:"%USERPROFILE%\\.claude\\settings.json"}),"）。"]})]})]}),(x||j)&&e.jsx("div",{className:"loading-line",children:x?"加载中…":"正在同步配置…"}),e.jsx(U,{message:_?.message,type:_?.type})]})}export{F as default};
