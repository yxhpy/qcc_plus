import{r as s,j as t}from"./vendor-HVpYYIdB.js";import{C}from"./Card-Bmh2bB8_.js";import{T as S}from"./Toast-BukLN0_W.js";import{c as l}from"./index-cFc9t1GX.js";import"./charts-USIkmnH5.js";function E(){const[j,b]=s.useState([]),[a,c]=s.useState(""),[o,m]=s.useState(1),[u,h]=s.useState(1),[d,x]=s.useState(30),[v,p]=s.useState(!1),[g,f]=s.useState(null),i=(e,n="success")=>{f({message:e,type:n}),setTimeout(()=>f(null),2200)},y=async()=>{try{const e=await l.getAccounts();b(e),c(n=>n||(e[0]?.id??""))}catch{i("加载账号失败","error")}},r=async()=>{if(a){p(!0);try{const e=await l.getConfig(a);m(e.retries||1),h(e.fail_limit||1),x(e.health_interval_sec||30)}catch(e){i(e.message||"加载失败","error")}finally{p(!1)}}};s.useEffect(()=>{y()},[]),s.useEffect(()=>{a&&r()},[a]);const N=async e=>{e.preventDefault();try{await l.updateConfig({retries:Math.min(10,Math.max(1,o)),fail_limit:Math.min(10,Math.max(1,u)),health_interval_sec:Math.min(300,Math.max(5,d))},a),i("配置已保存"),r()}catch(n){i(n.message||"保存失败","error")}};return t.jsxs("div",{className:"settings-page",children:[t.jsxs("div",{className:"settings-header",children:[t.jsx("h1",{children:"系统配置"}),t.jsx("p",{className:"sub",children:"调整重试、失败阈值和健康检查频率。"})]}),t.jsxs(C,{children:[t.jsxs("div",{className:"toolbar",children:[t.jsxs("label",{style:{minWidth:220},children:["选择账号",t.jsx("select",{value:a,onChange:e=>c(e.target.value),children:j.map(e=>t.jsxs("option",{value:e.id,children:[e.name,e.is_admin?" [管]":""]},e.id))})]}),t.jsx("div",{className:"spacer"}),t.jsx("button",{className:"btn ghost",type:"button",onClick:r,children:"刷新"})]}),t.jsxs("form",{className:"settings-form",onSubmit:N,children:[t.jsxs("label",{children:[t.jsx("span",{className:"label-title",children:"重试次数"}),t.jsx("input",{type:"number",name:"retries",min:1,max:10,value:o,onChange:e=>m(Number(e.target.value)),required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{className:"label-title",children:"失败阈值"}),t.jsx("input",{type:"number",name:"fail",min:1,max:10,value:u,onChange:e=>h(Number(e.target.value)),required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{className:"label-title",children:"健康检查间隔（秒）"}),t.jsx("input",{type:"number",name:"health",min:5,max:300,value:d,onChange:e=>x(Number(e.target.value)),required:!0})]}),t.jsx("button",{className:"btn primary",type:"submit",disabled:v,children:"保存配置"})]}),t.jsx("div",{className:"notice",style:{marginTop:24},children:"范围提示：重试 1-10，失败阈值 1-10，健康检查 5-300 秒。"})]}),t.jsx(S,{message:g?.message,type:g?.type})]})}export{E as default};
