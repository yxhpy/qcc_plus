import{r as n,j as s}from"./vendor-HVpYYIdB.js";import{C as I}from"./Card-Bmh2bB8_.js";import{T as P}from"./Toast-BukLN0_W.js";import{c as i}from"./index-qk43s-9n.js";import"./charts-USIkmnH5.js";function B(){const[a,C]=n.useState(null),[c,u]=n.useState(""),[m,h]=n.useState(""),[b,x]=n.useState(""),[g,f]=n.useState(!1),[T,S]=n.useState([]),[j,y]=n.useState(!1),[o,r]=n.useState(!1),[k,N]=n.useState(null),t=(e,p="success")=>{N({message:e,type:p}),setTimeout(()=>N(null),2200)},d=e=>{C(e),h(e.subdomain||""),x(e.zone||""),f(!!e.enabled),u("")},v=async()=>{y(!0);try{const e=await i.getTunnel();d(e)}catch(e){t(e.message||"加载失败","error")}finally{y(!1)}};n.useEffect(()=>{v()},[]);const _=async()=>{if(!m.trim()){t("子域名前缀必填","error");return}r(!0);try{const e={subdomain:m.trim(),enabled:g,zone:b.trim()};c.trim()&&(e.api_token=c.trim());const p=await i.saveTunnel(e);d(p),t("已保存")}catch(e){t(e.message||"保存失败","error")}finally{r(!1),u("")}},w=async()=>{r(!0);try{const e=await i.startTunnel();d(e),t("隧道已启动")}catch(e){t(e.message||"启动失败","error")}finally{r(!1)}},z=async()=>{r(!0);try{const e=await i.stopTunnel();d(e),t("隧道已停止")}catch(e){t(e.message||"停止失败","error")}finally{r(!1)}},A=async()=>{if(!a?.api_token_set&&!c.trim()){t("请先保存 API Token","error");return}try{const e=await i.listZones();S(e),t("域名列表已刷新")}catch(e){t(e.message||"获取域名失败","error")}},l=a?.status||"stopped",E=l==="running"?"运行中":l==="error"?"错误":"已停止",Z=l==="running"?"ok":l==="error"?"error":"muted";return s.jsxs("div",{className:"tunnel-page",children:[s.jsxs("div",{className:"tunnel-header",children:[s.jsx("h1",{children:"隧道设置"}),s.jsx("p",{className:"sub",children:"配置 Cloudflare Tunnel，动态暴露代理服务。"})]}),s.jsxs(I,{children:[s.jsxs("div",{className:"tunnel-status-line",children:[s.jsx("span",{className:`status-badge ${Z}`,children:E}),a?.public_url&&s.jsx("a",{className:"public-url",href:a.public_url,target:"_blank",rel:"noreferrer",children:a.public_url}),a?.last_error&&s.jsxs("span",{className:"last-error",children:["最后错误：",a.last_error]}),s.jsx("div",{className:"spacer"}),s.jsx("button",{className:"btn ghost",type:"button",onClick:v,disabled:j||o,children:"刷新"}),s.jsx("button",{className:"btn primary",type:"button",onClick:l==="running"?z:w,disabled:o||j,children:l==="running"?"停止隧道":"启动隧道"})]}),s.jsxs("div",{className:"tunnel-grid",children:[s.jsxs("label",{children:["Cloudflare API Token",s.jsx("input",{type:"password",value:c,onChange:e=>u(e.target.value),placeholder:a?.api_token_set?"已设置，留空不变":"cf token"}),s.jsx("small",{className:"hint",children:"Token 仅用于 Cloudflare API 调用，存储时会加密。"})]}),s.jsxs("label",{children:["子域名前缀",s.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"例如 myproxy",required:!0})]}),s.jsxs("label",{children:["域名",s.jsxs("div",{className:"zone-field",children:[s.jsx("input",{type:"text",list:"zone-options",value:b,onChange:e=>x(e.target.value),placeholder:"留空自动选择账户下首个域名"}),s.jsx("datalist",{id:"zone-options",children:T.map(e=>s.jsx("option",{value:e},e))}),s.jsx("button",{className:"btn ghost",type:"button",onClick:A,disabled:o,children:"获取域名"})]}),s.jsx("small",{className:"hint",children:"从 Cloudflare 帐号中选择根域名，子域名前缀将自动拼接。"})]}),s.jsxs("label",{className:"toggle-line",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:e=>f(e.target.checked)}),s.jsx("span",{children:"启用隧道（保存配置后，可点击启动）"})]})]}),s.jsxs("div",{className:"tunnel-actions",children:[s.jsx("button",{className:"btn primary",type:"button",onClick:_,disabled:o,children:"保存配置"}),s.jsx("button",{className:"btn ghost",type:"button",onClick:()=>u(""),disabled:o,children:"清空 Token 输入"})]})]}),s.jsx(P,{message:k?.message,type:k?.type})]})}export{B as default};
