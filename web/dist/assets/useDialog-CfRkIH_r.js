import{r as d,m as E,j as e,c as j}from"./vendor-HVpYYIdB.js";const h='a[href], button:not([disabled]), textarea, input, select, details,[tabindex]:not([tabindex="-1"])';function g({open:o,title:u,children:s,footer:c,onClose:t,closeOnMask:i=!0}){const a=d.useRef(null),n=d.useRef(null);if(d.useEffect(()=>{if(!o)return;const f=document.activeElement,p=document.body.style.overflow;document.body.style.overflow="hidden";const m=n.current?.querySelector('[data-autofocus="true"]');if(m)m.focus();else{const r=n.current?.querySelectorAll(h)?.[0];r?r.focus():n.current?.focus()}const b=l=>{if(l.key==="Escape"&&t?.(),l.key==="Tab"){const r=n.current?.querySelectorAll(h);if(!r||r.length===0)return;const y=r[0],v=r[r.length-1];l.shiftKey&&document.activeElement===y?(v.focus(),l.preventDefault()):!l.shiftKey&&document.activeElement===v&&(y.focus(),l.preventDefault())}};return document.addEventListener("keydown",b),()=>{document.removeEventListener("keydown",b),document.body.style.overflow=p,f?.focus()}},[o,t]),!o)return null;const x=e.jsx("div",{className:"modal-overlay",ref:a,onMouseDown:f=>{i&&f.target===a.current&&t?.()},children:e.jsxs("div",{className:"modal",role:"dialog","aria-modal":"true","aria-label":u||"对话框",ref:n,tabIndex:-1,children:[u&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:u}),e.jsx("button",{className:"btn ghost",type:"button",onClick:t,"aria-label":"关闭",children:"X"})]}),e.jsx("div",{className:"modal-body",children:s}),c&&e.jsx("div",{className:"modal-footer",children:c})]})});return E.createPortal(x,document.body)}function N({open:o,title:u="确认操作",message:s,confirmText:c="确认",cancelText:t="取消",closeOnMask:i=!0,onConfirm:a,onCancel:n}){return e.jsx(g,{open:o,title:u,closeOnMask:i,onClose:n,footer:e.jsxs("div",{className:"dialog-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:n,children:t}),e.jsx("button",{className:"btn primary",type:"button",onClick:a,children:c})]}),children:typeof s=="string"?e.jsx("p",{className:"dialog-message",children:s}):s})}function R(){const o=d.useRef(!1);return{confirm:d.useCallback(s=>new Promise(c=>{if(o.current){c(!1);return}o.current=!0;const t=document.createElement("div");document.body.appendChild(t);const i=j.createRoot(t),a=n=>{o.current=!1,i.unmount(),t.remove(),c(n)};i.render(e.jsx(N,{open:!0,...s,onConfirm:()=>a(!0),onCancel:()=>a(!1)}))}),[])}}export{g as M,R as u};
